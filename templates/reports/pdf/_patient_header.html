<!-- Patient Demographics Header Section -->
<style>
    .patient-header {
        display: flex;
        align-items: flex-start;
        background-color: var(--bg-header);
        padding: var(--space-lg);
        border-radius: 4pt;
        margin-bottom: var(--space-xl);
        page-break-inside: avoid;
        border-left: 4px solid var(--primary-color);
    }
    
    .patient-avatar {
        flex-shrink: 0;
        margin-right: var(--space-lg);
    }
    
    .patient-avatar img {
        width: 72pt;
        height: 72pt;
        border-radius: 50%;
        border: 2px solid var(--border-primary);
        object-fit: cover;
    }
    
    .patient-initials {
        width: 72pt;
        height: 72pt;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--font-size-2xl);
        font-weight: 700;
        border: 2px solid var(--border-primary);
    }
    
    .patient-demographics {
        flex-grow: 1;
    }
    
    .patient-name {
        font-size: var(--font-size-2xl);
        font-weight: 700;
        color: var(--primary-dark);
        margin-bottom: var(--space-xs);
        line-height: var(--line-height-tight);
    }
    
    .patient-identifiers {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-md);
        margin-bottom: var(--space-sm);
    }
    
    .patient-identifier {
        display: flex;
        align-items: center;
        font-size: var(--font-size-sm);
    }
    
    .identifier-label {
        font-weight: 600;
        color: var(--text-secondary);
        margin-right: var(--space-xs);
    }
    
    .identifier-value {
        color: var(--text-primary);
        font-family: var(--font-family-mono);
    }
    
    .patient-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-sm) var(--space-lg);
        margin-top: var(--space-sm);
        font-size: var(--font-size-sm);
    }
    
    .detail-item {
        display: flex;
    }
    
    .detail-label {
        font-weight: 600;
        color: var(--text-secondary);
        min-width: 80pt;
    }
    
    .detail-value {
        color: var(--text-primary);
    }
    
    .patient-status-badges {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-xs);
        margin-top: var(--space-md);
    }
    
    .status-badge {
        display: inline-block;
        padding: var(--space-xs) var(--space-sm);
        border-radius: 3pt;
        font-size: var(--font-size-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5pt;
    }
    
    .badge-active {
        background-color: #dcfce7;
        color: #166534;
        border: 1px solid #86efac;
    }
    
    .badge-alert {
        background-color: #fee2e2;
        color: #991b1b;
        border: 1px solid #fca5a5;
    }
    
    .badge-info {
        background-color: #dbeafe;
        color: #1e40af;
        border: 1px solid #93c5fd;
    }
</style>

<div class="patient-header">
    <div class="patient-avatar">
        {% if patient.avatar %}
            <img src="{{ patient.avatar.url }}" alt="{{ patient.full_name }}">
        {% else %}
            <div class="patient-initials">
                {{ patient.first_name|slice:":1"|upper }}{{ patient.last_name|slice:":1"|upper }}
            </div>
        {% endif %}
    </div>
    
    <div class="patient-demographics">
        <div class="patient-name">
            {{ patient.first_name }} {{ patient.last_name }}
        </div>
        
        <div class="patient-identifiers">
            <div class="patient-identifier">
                <span class="identifier-label">MRN:</span>
                <span class="identifier-value">{{ patient.mrn|default:"N/A" }}</span>
            </div>
            
            {% if patient.ssn %}
            <div class="patient-identifier">
                <span class="identifier-label">SSN:</span>
                <span class="identifier-value">***-**-{{ patient.ssn|slice:"-4:" }}</span>
            </div>
            {% endif %}
            
            <div class="patient-identifier">
                <span class="identifier-label">Patient ID:</span>
                <span class="identifier-value">{{ patient.id }}</span>
            </div>
        </div>
        
        <div class="patient-details">
            <div class="detail-item">
                <span class="detail-label">Date of Birth:</span>
                <span class="detail-value">{{ patient.date_of_birth|date:"F d, Y"|default:"N/A" }}</span>
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Age:</span>
                <span class="detail-value">
                    {% if patient.date_of_birth %}
                        {{ patient.age }} years
                    {% else %}
                        N/A
                    {% endif %}
                </span>
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Gender:</span>
                <span class="detail-value">{{ patient.get_gender_display|default:"N/A" }}</span>
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Primary Provider:</span>
                <span class="detail-value">
                    {% if patient.primary_provider %}
                        Dr. {{ patient.primary_provider.last_name }}
                    {% else %}
                        Not assigned
                    {% endif %}
                </span>
            </div>
            
            {% if patient.phone %}
            <div class="detail-item">
                <span class="detail-label">Phone:</span>
                <span class="detail-value">{{ patient.phone }}</span>
            </div>
            {% endif %}
            
            {% if patient.email %}
            <div class="detail-item">
                <span class="detail-label">Email:</span>
                <span class="detail-value">{{ patient.email }}</span>
            </div>
            {% endif %}
        </div>
        
        {% if patient.active_conditions_count or patient.has_allergies or patient.active_medications_count %}
        <div class="patient-status-badges">
            {% if patient.active_conditions_count %}
            <span class="status-badge badge-info">
                {{ patient.active_conditions_count }} Active Condition{{ patient.active_conditions_count|pluralize }}
            </span>
            {% endif %}
            
            {% if patient.has_allergies %}
            <span class="status-badge badge-alert">
                Allergies on File
            </span>
            {% endif %}
            
            {% if patient.active_medications_count %}
            <span class="status-badge badge-active">
                {{ patient.active_medications_count }} Active Medication{{ patient.active_medications_count|pluralize }}
            </span>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

